# Доброе утро, я начинаю свой курс по изучению NASM
## Что такое NASM?
    NASM - netwide Assembler - x86-64
## Машинные инструкции 
    Программы состоят из инструкций, которые интерпретируюет процессор. Каждая команда имеет числовое представления действия.
    
    Пример:
      С7 в hex или (11000111) в bin может означать "Поместить значение в регистр RAX" 
      B8 в hex или (10111000) в bin может означать "Поместить значение в регистр EAX"
          Разницы между C7 и B8 в том что они выполняют аналогичные действия но для разеных архитектур C7 -x86-64 и B8 - x86-32
      Но для облигчения жизни проргаммистов были созданны команды
        ``assembler
        mov rax, 1 //для 64
        mov eax, 1 //для 32
        ```
## Как процессор исполняет команды
    Процессор использует цикл выборки и выполнения 
    1) Получает команду по адресу, указанному в регистре IP (или RIP / PC)
    2) Расшифровывает, что требуется 
    3) Смещает указатель к следующей инструкции 
    4) Выполняет операцию.
## Регистры системы
    Регистр - это особые области памяти в процессоре, которые выполняют ключевую роль в вычислении и обработке данных
    Существует несколько груп регистров в архитектуре х86-64 \
    1) Регистры общего назначения
    2) специализтированные 
    3) Сегментные 
    4) Служебные 
    В контексте разработки программ на ассемблере чаще всего используются универсальные регистры 

## Универсальные регистры 
Список универсальных регистров:

    64-битные: RAX, RBX, RCX, RDX, RSI, RDI, RBP, RSP, R8–R15

    32-битные: EAX, EBX, ECX, EDX, ESI, EDI, EBP, ESP, R8D–R15D

    16-битные: AX, BX, CX, DX, SI, DI, BP, SP, R8W–R15W

    8-битные: AL, AH, BL, BH, CL, CH, DL, DH, DIL, SIL, BPL, SPL, R8B–R15B

## регистры флагов (RFLAGS)
    Процессоры х86-64  содержат регистр флагов, в котором размещены отдельные биты, отражающие текущее состояние процессора и результат выполнения инструкций.
    Для работы с флагами в NASM используются команды set и test, которые позволяют манипулировать флагами 

    Таблица (Флаги в регистре RFLAGS)

Позиция 	Обозначение 	            Назначение
0 	        CF (Carry Flag) 	        Флаг переноса: сигнализирует о выходе значения за границу разрядной сетки при                                     сложении или необходимости заимствования при вычитании.

2 	        PF (Parity Flag) 	        Флаг четности: показывает, содержит ли младший ю                                       байт результата четное количество единиц.

4 	        AF (Auxiliary Carry Flag) 	Флаг полупереноса: используется в 
                                        двоично-десятичной арифметике, отслеживает перенос между 3-м и 4-м битом.

6 	        ZF (Zero Flag) 	            Флаг нуля: устанавливается, если операция возвращает ноль.

7 	        SF (Sign Flag) 	            Флаг знака: отражает знак результата (1 — если отрицательный).

8 	        TF (Trap Flag)      	    Флаг трассировки: при активации разрешает
                                        пошаговое выполнение инструкций, используется при отладке.

9 	        IF (Interrupt Flag)   	    Флаг прерываний: его установка позволяет 
                                        внешним устройствам инициировать аппаратные прерывания.

10 	        DF (Direction Flag) 	    Флаг направления: определяет направление 
                                        перемещения по памяти (вперед или назад) при строковых операциях.

11 	        OF (Overflow Flag) 	        Флаг переполнения: фиксирует выход
                                        результата арифметической операции за пределы допустимого диапазона для знаковых чисел.

## Специализированные регистры
    Данные регистры используются для операций с плавающей точкой и векторных вычислений
    1) FTU 
    2) SSE и AVX регистры 

## NASM в Linux 
    Для установки воспользуемся командами 
    ```bash
    //Для UBUNTU и DEBIAN
    sudo apt update
    sudo apt install -y nasm
    nasm -v
    //Для ARCH-LINUX
    sudo pacman -S nasm
    nasm -v 
    ```
## Первый шаг 
    Создаем файл с расширением .asm

    ```nasm
    global _start
    section .text
    _start
        mov rax, 60 ; Системный вызов выхода из программы
        mov rdi, 42 ; код возврата 
        syscall     ; вызов ядра 
    ```
    А теперь давайте разберем данный код поподробнее 
    1) global - сообщает компановщику, какуб метку искать в качестве точки входа 
    2) .text - секция, в которой размещается используемый код 
    3) mov rax, 60 - номер системного вызова exit (завершение процесса)
    4) mov rdi, 42 - код завершения (передается OC)
    5) syscall - команда обращения к системному API ядра 

### Компиляция и сборка
    Для сборки проекта следует:
    ```bash
    nasm -f elf64 program.asm -o program.o
    ld program.o -o program
    ./program
    ```

## Программа с выводом текста 
    ```nasm
    global _start 

    section .data
    text_message: db "Hellow NASM!!!", 0xA

    section .text 
    _start:
        mov rax, 1
        mov rdi, 1
        mov rsi, text_message
        mov rdx, 15
        syscall

        mov rax, 60
        xor rdi, rdi
        syscall
    ```
### Сборка и запуск
    ```bash
    nasm -f elf64 $(source).asm       # Ассемблирует .asm файл в объектный файл (.o) в 64-битном формате
    ld -o $(source) $(source).o       # Линкует объектный файл в исполняемый файл с именем $(source)
    rm $(source).o                    # Удаляет временный объектный файл
    ./print
    ```

    А теперь давайте разберем данный код поподробнее 
    1) .data - секция для хранения данных(в нашем случае строки)
    2) db - директива определения байтов (ASCII - строка и 0xA - перевод строки)
    3) rax = 1 - системный вызов write
    4) rdi = 1 - стандартный вывод
    5) rsi - адрес начала строки
    6) rdx - длина выводимых данных

## Копирование с помащью MOV
    Инструкция mov - одна из основ в assembler. Она выполняет копирование данных между регистрами 
### пример 
    mov destination, source
    1) destination - куда копируются данные(регистр или ячейка памяти)
    2) source - откуда берутся данные(регистр, значение или память)
### Даступные формы
    1) Регистр ← Регистр
    2) Регистр ← Непосредственное значение (literal)
    3) Регистр ← Память (через косвенную адресацию)
    4) Память ← Регистр
    5) Память ← Непосредственное значение
