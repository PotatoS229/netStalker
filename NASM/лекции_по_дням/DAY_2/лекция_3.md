# Третья лекция: Переходы JMP

## Введение

Регистр RIP указывает на адрес следующей инструкции, которая будет выполнена процессором. При выполнении инструкций регистр обновляется автоматически. Однако, его можно изменить вручную с помощью инструкций перехода, тем самым изменив поток исполнения программы.

Для тех, кто забыл, рекомендую прочитать:

## Как процессор исполняет команды

Процессор использует цикл выборки и выполнения (Fetch-Execute Cycle):

1. **Выборка:** Получает инструкцию по адресу, указанному в регистре RIP (Instruction Pointer)
2. **Декодирование:** Расшифровывает, какая операция требуется
3. **Инкремент:** Увеличивает указатель на следующую инструкцию
4. **Выполнение:** Выполняет декодированную операцию
5. **Повторение:** Возвращается к шагу 1

---

## Безусловный переход (jmp)

Данная инструкция выполняет безусловный переход к другому месту в коде. Она изменяет значение RIP и передает управление другой инструкции.

### Переход к метке

Пример:

```nasm
section .text
global _start

_start:
    mov rdi, 11
    jmp Завершение
    mov rdi, 99     ; Эта строка не выполнится

Завершение:
    mov rax, 60     ; Системный вызов завершения
    syscall
```

### Переход по адресу из регистра

Пример:

```nasm
section .text
global _start

_start:
    lea rbx, [Метка]    ; Загружаем адрес метки в регистр
    mov rdi, 22
    jmp rbx             ; Переход по адресу в RBX
    mov rdi, 99         ; Эта строка не выполнится

Метка:
    mov rax, 60
    syscall
```

### Переход по адресу из памяти

Пример:

```nasm
section .text
global _start

_start:
    mov rdi, 23
    jmp [переход_по_адресу]    ; Загружаем адрес из памяти
    mov rdi, 99                 ; Эта строка не выполнится

Метка:
    mov rax, 60
    syscall

section .data
переход_по_адресу: dq Метка    ; Переменная с адресом метки
```

**Важное замечание:** Для перехода по адресу из памяти:
- Переменная `переход_по_адресу` должна находиться в секции `.data` (а не `.text`)
- Она должна содержать корректный 64-битный адрес инструкции (используем `dq`)

`jmp [имя]` означает: «перейти по адресу, который хранится в памяти по адресу `имя`».